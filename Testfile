describe("sha1Base64", () => {
  let mockDigest: jest.Mock;

  beforeEach(() => {
    // Mock crypto.subtle.digest
    mockDigest = jest.fn().mockResolvedValue(
      new Uint8Array([1, 2, 3]).buffer   // mock SHA-256 output
    );

    // @ts-ignore
    global.crypto = {
      subtle: {
        digest: mockDigest,
      },
    };
  });

  it("should compute SHA-256 base64 for a Blob", async () => {
    // Mock Blob
    const blob = new Blob(["test data"]);

    // Mock arrayBuffer() for the blob
    const mockArrayBuffer = new TextEncoder().encode("test data").buffer;
    blob.arrayBuffer = jest.fn().mockResolvedValue(mockArrayBuffer);

    const result = await sha1Base64(blob);

    // Expected base64 from [1,2,3]
    const expectedBase64 = btoa(String.fromCharCode(1, 2, 3));

    expect(result).toBe(expectedBase64);

    // Ensure arrayBuffer() was called
    expect(blob.arrayBuffer).toHaveBeenCalledTimes(1);

    // Ensure digest was called correctly
    expect(mockDigest).toHaveBeenCalledWith(
      "SHA-256",
      mockArrayBuffer
    );
  });
});
